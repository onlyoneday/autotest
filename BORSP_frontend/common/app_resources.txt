*** Settings ***

Documentation  A resource file containing the specific keywords and variables for application
Library        Selenium2Library
Library        String
Resource       ../common/resources.txt

*** Keywords ***

Delete App From Button
    #从应用列表的Button删除应用
    Click Element   //*[@id='stackListApp']/tbody/tr[1]/td[8]
    Click Element   stackListDelete0
    Click And Wait  css=button:nth-child(2)>span.ng-binding

Delete App From Detail
    #从应用详情的菜单删除应用
    Click And Wait  stackDetailMenu
    Click And Wait  stackDetailDelete
    Click And Wait  css=button:nth-child(2)>span.ng-binding

Delete App By Name
    [Arguments]     ${appname}
    ${index} =      Get App Index    ${appname}
    ${path} =       Evaluate  '//*[@id="stackListApp"]/tbody/tr['+'${index}'+']/td[8]'
    Click Element   ${path}
    ${index} =      Evaluate   ${index}-1
    ${button} =     Evaluate  'stackListDelete'+'${index}'
    Click Element   ${button}
    Click And Wait  css=button:nth-child(2)>span.ng-binding

Update App By Name
    [Arguments]     ${appname}
    ${index} =      Get App Index    ${appname}
    ${path} =       Evaluate  '//*[@id="stackListApp"]/tbody/tr['+'${index}'+']/td[8]'
    Click Element   ${path}
    ${index} =      Evaluate   ${index}-1
    ${button} =     Evaluate  'stackListUpdate'+'${index}'
    Click And Wait  ${button}

Change App Owner
    [Arguments]     ${appname}
    ${index} =      Get App Index    ${appname}
    ${path} =       Evaluate  '//*[@id="stackListApp"]/tbody/tr['+'${index}'+']/td[8]'
    Click Element   ${path}
    ${index} =      Evaluate   ${index}-1
    ${button} =     Evaluate  'stackLisChangeAppUser'+'${index}'
    Click And Wait  ${button}

Suspended App By Name
    [Arguments]     ${appname}
    ${index} =      Get App Index    ${appname}
    ${path} =       Evaluate  '//*[@id="stackListApp"]/tbody/tr['+'${index}'+']/td[8]'
    Click Element   ${path}
    ${index} =      Evaluate   ${index}-1
    ${button} =     Evaluate  'stackListSuspended'+'${index}'
    Click And Wait  ${button}

Extend App By Name
    [Arguments]     ${appname}
    ${index} =      Get App Index    ${appname}
    ${path} =       Evaluate  '//*[@id="stackListApp"]/tbody/tr['+'${index}'+']/td[8]'
    Click Element   ${path}
    ${index} =      Evaluate   ${index}-1
    ${button} =     Evaluate  'stackListExtend'+'${index}'
    Click And Wait  ${button}
    
Get App Index
    [Arguments]     ${name}
    ${row} =        Get Matching Xpath Count    //*[@id='stackListApp']/tbody/tr[*]
    ${row} =        Evaluate  ${row}+1
    :FOR    ${index}      IN RANGE   1  ${row}
    \       ${path} =     Evaluate   '//*[@id="stackListApp"]/tbody/tr['+'${index}'+']/td[1]'
    \       ${capp} =     Get Text   ${path}
    \       ${appname} =  Fetch From Right  ${capp}  -
    \       Return From Keyword If   "${appname}" == "${name}"   ${index}

Create App
    [Arguments]     ${name}    ${cluster}
    #填写应用名称
    Input Text      stackAppName    ${name}
    #填写镜像名称
    Input Text      stackImageAddress    blackicebird/2048:latest
    #选择集群
    ${path} =       Evaluate   '//*[@value='+'"${cluster}"'+']'
    Run Keyword If  "${cluster}" <> "${EMPTY}"    Click Element   //*[@name="staticForm"]/div/div/div/md-select
    Run Keyword If  "${cluster}" <> "${EMPTY}"    Click Element   ${path}
    #填写容器个数
    Input Text      stackInstanceNumber  1

Input Simple App
    #填写应用名称
    ${app name} =  Generate Name
    Input Text     stackAppName    ${app name}
    #填写镜像名称
    Input Text     stackImageAddress    blackicebird/2048:latest
    #选择集群
    Click Element  //*[@name="staticForm"]/div/div/div/md-select
    Click Element  //*[@value="clustermmj"]
    #填写容器规格
    Input Text     stackCpus    0.2
    Clear Element Text  stackMemory
    Input Text     stackMemory   32
    #填写容器个数
    Input Text     stackInstanceNumber   1
    [Return]       ${app name}

Generate Name
    ${random} =    Get Lower String
    ${app name} =  Evaluate  'application'+'${random}'
    [Return]       ${app name}

Input Advanced App  
    [Arguments]    ${AEDHC}
    Click Element  css=.fa-chevron-down
    Sleep   ${SLEEP TIME}
    ${a} =   Get Substring   ${AEDHC}   0  1
    ${e} =   Get Substring   ${AEDHC}   1  2
    ${d} =   Get Substring   ${AEDHC}   2  3
    ${h} =   Get Substring   ${AEDHC}   3  4
    ${c} =   Get Substring   ${AEDHC}   4
    Run Keyword If  '${a}' == '1'   Add Address
    Run Keyword If  '${e}' == '1'   Add Environment
    Run Keyword If  '${d}' == '1'   Add Docker
    Run Keyword If  '${h}' == '1'   Add Healthchecks
    Run Keyword If  '${c}' == '1'   Add Command

Add Address
    Input Text     //*[@name='portMappings']/input[1]   80
    Click Element  //*[@name='portMappings']/md-select
    Click Element  //*[@value='HTTP']
    Input Text     //*[@name='portMappings']/input[2]   8080 

Add Environment
    Click Element  stackAddMountpoints
    Input Text     stackEnvsKey0     ENV
    Input Text     stackEnvsValue0   environment 

Add Docker
    Click Element  stackParametersAdd
    Input Text     stackDockerKey-0    hostname 
    Input Text     stackDockerValue-0  mmj

Add Healthchecks
    Click Element  stackAddHealthChecks
    #协议
    Click Element  stackProtocolSelect-0
    Click Element  stackprotocoOption-1
    #路径
    Input Text     stackHelthPath-0  /
    #宽限时间
    Input Text     stackGracePeriodSeconds-0  300
    #间隔时间
    Input Text     stackIntervalSeconds-0  60
    #检查超时
    Input Text     stackTimeoutSeconds-0  10
    #最多持续失败次数
    Input Text     stackMaxConsecutiveFailures-0  5
    #端口类型
    Click Element  stackPortSelect-0
    Click Element  stackPortOption-1
    #端口号
    Input Text     stackHealthPort-0  80

Add Command
    Input Text     stackCMD    ${CMD TEXT}


